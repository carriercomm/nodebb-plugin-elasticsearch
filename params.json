{"name":"Nodebb-plugin-elasticsearch","tagline":"adding advanced fulltext search to NodeBB","body":"\r\n```\r\nTODO / open questions: \r\n1) How to hook into post changes?\r\n2) How to redirect the search submit action to the plugin custom route?\r\n\r\n   \r\nWhat works:\r\n- indexing new posts to local ES server (localhost:9200)\r\n- automatic index creation \"nodebb_posts\"\r\n- automatic setting of index mapping for autocompletion \r\n- custom route /nodebb-plugin-elasticsearch/search/:term\r\n- on plugin activation in NodeBB admin GUI, ALL existing posts are indexed automatically\r\n   TODO: store last index date, and index only new ... well but plugin \r\n   might be activated only once, and it might be an option to trigger the process\r\n   again e.g after changing ES server ...\r\n   \r\n```\r\n\r\n# Installation (on Debian)\r\n## 1) ElasticSearch server\r\n\r\n```\r\napt-get install openjdk-7-jre-headless -y\r\nwget https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-0.90.6.deb\r\ndpkg -i elasticsearch-0.90.6.deb\r\n## install some useful plugins\r\n/usr/share/elasticsearch/bin/plugin -install mobz/elasticsearch-head\r\n/usr/share/elasticsearch/bin/plugin --install jettro/elasticsearch-gui \r\n\r\nopen browser and go to http://localhost:9200/_plugin/head\r\n```\r\n\r\n## 2) NodeBB plugin \r\n```\r\n   npm install seti123/nodebb-plugin-elasticsearch\r\n```\r\n\r\n## 3) restart NodeBB (./nodebb dev), activate plugin in admin and make some posts in nodeBB\r\n```\r\n# to see plugin loading and debug out put ...\r\n./nodebb dev\r\n```\r\n\r\nOn the console you should see some dub messages about indexing all posts ...\r\n\r\n## 4) Check autocomplete feature or search \r\n\r\n```\r\ncurl -X POST localhost:9200/nodebb_posts/_suggest -d '\r\n{\r\n  \"nodebb_posts\" : {\r\n    \"text\" : \"ElasticSearch\",\r\n    \"completion\" : {\r\n      \"field\" : \"content_suggest\"\r\n    }\r\n  }\r\n}'\r\n```\r\nTitle suggested for autocomplete:\r\n```\r\n{\"_shards\":{\"total\":5,\"successful\":5,\"failed\":0},\"nodebb_posts\":[{\"text\":\"ElasticSearch\",\"offset\":0,\"length\":13,\"options\":[{\"text\":\"Another new blog\",\"score\":1.0}]}]}\r\n```\r\nLets search\r\n```\r\n1) curl localhost:9200/nodebb_posts/_search?q=new\r\n```\r\nOR on NodeBB assuming on localhost\r\n```\r\n1) http://localhost/elasticsearch/*\r\n```\r\nResult 1):\r\n\r\n```\r\n{\r\n\r\n    \"took\": 3,\r\n    \"timed_out\": false,\r\n    \"_shards\": {\r\n        \"total\": 5,\r\n        \"successful\": 5,\r\n        \"failed\": 0\r\n    },\r\n    \"hits\": {\r\n        \"total\": 2,\r\n        \"max_score\": 0.25,\r\n        \"hits\": [\r\n            {\r\n                \"_index\": \"nodebb_posts\",\r\n                \"_type\": \"nodebb_posts\",\r\n                \"_id\": \"26\",\r\n                \"_score\": 0.25,\r\n                \"_source\": {\r\n                    \"pid\": 26,\r\n                    \"uid\": \"1\",\r\n                    \"tid\": 23,\r\n                    \"content\": \"<p>this is the first blog entry with ElasticSearch support</p>\\n\",\r\n                    \"timestamp\": 1389789466903,\r\n                    \"reputation\": 0,\r\n                    \"editor\": \"\",\r\n                    \"edited\": 0,\r\n                    \"deleted\": 0,\r\n                    \"title\": \"A new blog\",\r\n                    \"content_suggest\": [\r\n                        \"A new blog\",\r\n                        \"<p>this is the first blog entry with ElasticSearch support</p>\\n\"\r\n                    ]\r\n                }\r\n            },\r\n            \r\n            ....\r\n```\r\nResult 2) in NodeBB\r\n```\r\n{\r\n\r\n    \"show_no_topics\": \"hide\",\r\n    \"show_no_posts\": \"hide\",\r\n    \"show_results\": \"\",\r\n    \"search_query\": \"*\",\r\n    \"posts\": [\r\n        {\r\n            \"pid\": \"27\",\r\n            \"tid\": \"24\",\r\n            \"content\": \"<p>My second entry with ElasticSearch support</p>\\n\",\r\n            \"uid\": \"1\",\r\n            \"timestamp\": \"1389789491362\",\r\n            \"deleted\": \"0\",\r\n            \"fields\": [\r\n                \"pid\",\r\n                \"tid\",\r\n                \"content\",\r\n                \"uid\",\r\n                \"timestamp\",\r\n                \"deleted\"\r\n            ],\r\n            \"relativeTime\": \"2014-01-15T12:38:11.362Z\",\r\n            \"username\": \"admin\",\r\n            \"userslug\": \"admin\",\r\n            \"user_rep\": \"1\",\r\n            \"user_postcount\": \"37\",\r\n            \"user_banned\": false,\r\n            \"picture\": \"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?size=128&default=identicon&rating=pg\",\r\n            \"signature\": \"\",\r\n            \"additional_profile_info\": \"\",\r\n            \"editorname\": null,\r\n            \"editorslug\": null,\r\n            \"categoryName\": \"Blogs\",\r\n            \"categoryIcon\": \"fa-pencil\",\r\n            \"categorySlug\": \"4/blogs\",\r\n            \"title\": \"2nd entry\",\r\n            \"topicSlug\": \"24/2nd-entry\"\r\n        },\r\n        {\r\n            \"pid\": \"34\",\r\n            \"tid\": \"31\",\r\n            \"content\": \"<p>Amazing what you can do with ElasticSearch</p>\\n\",\r\n            ...\r\n```\r\n\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}